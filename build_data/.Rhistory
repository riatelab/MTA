load("/home/nlambert/Documents/R/MTA/data/nuts2010.RData")
nuts2010@data
head(nuts2010@data)
#############################################
# MTA: Multiscalar territorial analysis
# Nicolas LAMBERT, 2015
#############################################
#rm(list=ls())
# PACKAGES
library(rgeos)
library(reshape2)
#remove.packages("MTA")
# DATA
#' Spatial dataframe (polygons) of the NUTS regions (2010)
#'
#' European regions (NUTS 2010 version)
#' @name nuts2010
#' @field nuts3 nuts3 code
#' @field nuts2 nuts2 code
#' @field nuts1 nuts1 code
#' @field nuts0 nuts0 code
#' @field popt2008 total population in 2008 (inh.) - source : ESPON database, 2014
#' @field pdg2008 Gross domestic product iun 2008 (euros) - source : ESPON database, 2014
#' @docType data
#' @keywords data
NULL
# GLOBAL DEVIATION ----------------------
#' Global deviation
#'
#' This function compute the global deviation from two count data according to the MyperAtlas Methodolgy.
#'
#' @details The general context may be the whole chosen study area. In such a case, the associated map will be the same as the associated map to the ratio itself. So, the user may choose another general context or a reference value. For instance, in the example of the EU, even if the study area is the 29 potential countries, it may be of interest to observe the spatial differentiations according to another global reference, for instance the global value associated to EU15. For this level, the user may also exogenously enter a value. By default, this value has first been set to the value of the global area.
#'
#' @param spdf Spatial polygon data frame
#' @param id Unique identifier of the data frame (character)
#' @param stock1 Numerator
#' @param stock2 Denominator
#'
#' @examples
#' dev <-globalDev(spdf=nuts2010,id="nuts3",stock1="gdp2008",stock2="popt2008")
#' head(dev)
#'
#' @return dataframe
#'
#' @export
globalDev<-function(spdf,id,stock1,stock2){
global <- sum(spdf@data[stock1])/sum(spdf@data[stock2])
spdf@data$ratio <- spdf@data[stock1] / spdf@data[stock2]
spdf@data$dev<-(spdf@data$ratio/global)*100
globaldev <- data.frame(spdf@data[,id],spdf@data[stock1],spdf@data[stock2],spdf@data$ratio,spdf@data$dev)
names(globaldev) <- c(id,stock1,stock2,"ratio","globalRel")
# redistribution
globaldev$globalAbs <- globaldev[,stock1]-(global*globaldev[,stock2])
return(globaldev)
}
library("MTA")
dev <-globalDev(spdf=nuts2010,id="nuts3",stock1="gdp2008",stock2="popt2008")
head(dev,20)
plot(nuts2010)
head(nuts2010@data)
head(nuts2010@data,100)
head(nuts2010@data,1000)
library("rgdal")
setwd("/home/nlambert/Documents/R/MTA/build_data")
spdf <- readOGR(dsn ="data/",layer = "GEOM_EU34_NUTS2010")
spdf<-spdf[spdf@data$level3==1,]
spdf@data <- data.frame(nuts3=spdf@data$ID)
spdf@data$nuts2 <-substr(spdf@data$nuts3,1,4)
spdf@data$nuts1 <-substr(spdf@data$nuts3,1,3)
spdf@data$nuts0 <-substr(spdf@data$nuts3,1,2)
df <- read.csv("data/data_nuts3.txt",header=T,sep="\t",dec=",",encoding="utf-8")
spdf@data <- data.frame(spdf@data, df[match(spdf@data$nuts3, df$ID),c("gdp_2008","gdp_pps_2008","pop_t_2008")])
colnames(spdf@data)<-c("nuts3","nuts2","nuts1","nuts0","gdp2008","gdppps2008","popt2008")
plot(spdf)
head(spdf@data)
head(spdf@data,10000)
spdf <- readOGR(dsn ="data/",layer = "GEOM_EU34_NUTS2010")
plot(spdf)
head(spdf@data,10000)
head(spdf@data,100)
head(spdf@data,10)
head(spdf@data$ID,10)
spdf@data$ID
setwd("/home/nlambert/Documents/R/MTA/build_data")
spdf <- readOGR(dsn ="data/",layer = "GEOM_EU34_NUTS2010")
spdf<-spdf[spdf@data$level3==1,]
spdf@data <- data.frame(nuts3=spdf@data$ID)
spdf@data$nuts2 <-substr(spdf@data$nuts3,1,4)
spdf@data$nuts1 <-substr(spdf@data$nuts3,1,3)
spdf@data$nuts0 <-substr(spdf@data$nuts3,1,2)
head(spdf@data$ID)
head(spdf@data)
head(spdf@data$nuts3)
spdf@data$nuts3
df <- read.csv("data/data_nuts3.txt",header=T,sep="\t",dec=",",encoding="utf-8")
head(df)
spdf@data <- data.frame(spdf@data, df[match(spdf@data$nuts3, df$ID),c("gdp_2008","gdp_pps_2008","pop_t_2008")])
spdf@data$nuts3
spdf@data
library("rgdal")
setwd("/home/nlambert/Documents/R/MTA/build_data")
spdf <- readOGR(dsn ="data/",layer = "GEOM_EU34_NUTS2010")
spdf<-spdf[spdf@data$level3==1,]
spdf@data <- data.frame(nuts3=spdf@data$ID)
spdf@data$nuts2 <-substr(spdf@data$nuts3,1,4)
spdf@data$nuts1 <-substr(spdf@data$nuts3,1,3)
spdf@data$nuts0 <-substr(spdf@data$nuts3,1,2)
df <- read.csv("data/data_nuts3.txt",header=T,sep="\t",dec=",",encoding="utf-8")
head(df)
spdf@data
spdf@data <- data.frame(spdf@data, df[match(spdf@data$nuts3, df$ID),c("gdp_2008","gdp_pps_2008","pop_t_2008")])
spdf@data
spdf <- readOGR(dsn ="data/",layer = "GEOM_EU34_NUTS2006")
setwd("/home/nlambert/Documents/R/MTA/build_data")
spdf <- readOGR(dsn ="data/",layer = "GEOM_EU34_NUTS2006")
spdf<-spdf[spdf@data$level3==1,]
library("rgdal")
setwd("/home/nlambert/Documents/R/MTA/build_data")
spdf <- readOGR(dsn ="data/",layer = "GEOM_EU34_NUTS2006")
spdf <- readOGR(dsn ="data/",layer = "GEOM_EU34_NUTS2006_poly")
spdf<-spdf[spdf@data$level3==1,]
head(spdf@data)
spdf@data$test<-dim(spdf@data$ID)
head(spdf@data)
dim(spdf@data$ID)
spdf@data$test<-length(spdf@data$ID)
head(spdf@data)
spdf@data$test<-len(spdf@data$ID)
library("rgdal")
setwd("/home/nlambert/Documents/R/MTA/build_data")
spdf <- readOGR(dsn ="data/",layer = "GEOM_EU34_NUTS2006_poly")
colnames(spdf@data$ID) <- "nuts3"
spdf<-spdf[spdf@data$level3==1,]
spdf <- readOGR(dsn ="data/",layer = "GEOM_EU34_NUTS2006_poly")
colnames(spdf@data$ID) <- "nuts3"
colnames(spdf@data$ID) <- c("nuts3")
colnames(spdf@data$ID)
names(spdf@data$ID)
head(spdf@data)
colnames(spdf@data) <- c("nuts3")
head(spdf@data)
spdf <- readOGR(dsn ="data/",layer = "GEOM_EU34_NUTS2006_poly")
colnames(spdf@data) <-"nuts3"
head(spdf@data)
spdf<-spdf[spdf@data$level3==1,]
spdf@data <- data.frame(nuts3=spdf@data$ID)
spdf@data$nuts2 <-substr(spdf@data$nuts3,1,4)
spdf@data$nuts1 <-substr(spdf@data$nuts3,1,3)
setwd("/home/nlambert/Documents/R/MTA/build_data")
spdf <- readOGR(dsn ="data/",layer = "GEOM_EU34_NUTS2006_poly")
#colnames(spdf@data) <-"nuts3"
#spdf<-spdf[spdf@data$level3==1,]
spdf@data <- data.frame(nuts3=spdf@data$ID)
spdf@data$nuts2 <-substr(spdf@data$nuts3,1,4)
spdf@data$nuts1 <-substr(spdf@data$nuts3,1,3)
spdf@data$nuts0 <-substr(spdf@data$nuts3,1,2)
df <- read.csv("data/data_nuts3.txt",header=T,sep="\t",dec=",",encoding="utf-8")
head(df)
spdf@data <- data.frame(spdf@data, df[match(spdf@data$nuts3, df$ID),c("gdp_2008","gdp_pps_2008","pop_t_2008")])
colnames(spdf@data)<-c("nuts3","nuts2","nuts1","nuts0","gdp2008","gdppps2008","popt2008")
plot(spdf)
spdf@data
save(nuts2006, file = "nuts2006.RData")
nuts2006 <- spdf
save(nuts2006, file = "nuts2006.RData")
